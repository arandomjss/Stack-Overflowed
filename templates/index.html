<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>SkillGenome Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea, #764ba2);
            min-height: 100vh;
            padding: 20px
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, .2);
            padding: 30px
        }

        h1 {
            color: #333;
            text-align: center;
            font-size: 2em;
            margin-bottom: 10px
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px
        }

        .user-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none
        }

        .user-info.show {
            display: block
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap
        }

        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666
        }

        .tab:hover {
            color: #667eea
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea
        }

        .tab-content {
            display: none
        }

        .tab-content.active {
            display: block
        }

        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea
        }

        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em
        }

        .form-group {
            margin-bottom: 12px
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
            font-size: 13px
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea
        }

        button {
            background: #667eea;
            color: #fff;
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 5px
        }

        button:hover {
            background: #5568d3
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px
        }

        .result {
            margin-top: 12px;
            padding: 12px;
            background: #fff;
            border-radius: 8px;
            border-left: 4px solid #667eea
        }

        .result.success {
            border-left-color: #28a745
        }

        .result.error {
            border-left-color: #dc3545
        }

        .result pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 11px;
            max-height: 300px;
            overflow-y: auto
        }

        .score {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 15px 0
        }

        .rec {
            background: #fff;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid #ffc107
        }

        .rec.high {
            border-left-color: #dc3545
        }

        .rec.medium {
            border-left-color: #ffc107
        }

        .rec.low {
            border-left-color: #28a745
        }

        .badge {
            display: inline-block;
            background: #fff;
            padding: 6px 12px;
            margin: 4px;
            border-radius: 15px;
            border: 2px solid #667eea;
            font-size: 12px
        }

        .conf {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            margin-left: 4px;
            font-weight: 600
        }

        .conf.h {
            background: #d4edda;
            color: #155724
        }

        .conf.m {
            background: #fff3cd;
            color: #856404
        }

        .conf.l {
            background: #f8d7da;
            color: #721c24
        }

        @media(max-width:768px) {
            .grid {
                grid-template-columns: 1fr
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1> SkillGenome</h1>
        <p class="subtitle">Skill Intelligence Platform - Test Interface</p>
        <div id="userInfo" class="user-info">
            <strong>User:</strong> <span id="uName"></span> (<code id="uId"></code>)<br>
            <strong>Target:</strong> <span id="uRole"></span> in <span id="uSector"></span>
        </div>
        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)"> Profile</button>
            <button class="tab" onclick="switchTab(1)"> Skills</button>
            <button class="tab" onclick="switchTab(2)"> LinkedIn</button>
            <button class="tab" onclick="switchTab(3)"> GitHub</button>
            <button class="tab" onclick="switchTab(4)"> Analysis</button>
            <button class="tab" onclick="switchTab(5)"> Resume</button>
        </div>
        <div id="t0" class="tab-content active">
            <div class="section">
                <h2>Create Profile</h2>
                <div class="grid">
                    <div class="form-group"><label>Name *</label><input id="name" placeholder="Alice Johnson"></div>
                    <div class="form-group"><label>Email *</label><input id="email" placeholder="alice@uni.edu"></div>
                </div>
                <div class="grid">
                    <div class="form-group"><label>Sector *</label>
                        <select id="sector">
                            <option>Healthcare</option>
                            <option>Agriculture</option>
                            <option>Urban</option>
                        </select>
                    </div>
                    <div class="form-group"><label>Role *</label><input id="role" placeholder="data scientist"></div>
                </div><button onclick="createProfile()">Create Profile</button>
                <div id="r0"></div>
            </div>
            <div class="section">
                <h2>View Profile</h2>
                <div class="form-group"><label>User ID</label><input id="vid"></div>
                <button onclick="viewProfile()">View Profile</button>
                <div id="r1"></div>
            </div>
        </div>
        <div id="t1" class="tab-content">
            <div class="section">
                <h2>Add Skill</h2>
                <div class="form-group"><label>User ID</label><input id="sid"></div>
                <div class="grid">
                    <div class="form-group"><label>Skill *</label><input id="sname" placeholder="Python"></div>
                    <div class="form-group"><label>Context *</label><input id="sctx" placeholder="Healthcare Data">
                    </div>
                </div>
                <div class="grid">
                    <div class="form-group"><label>Confidence (0-1)</label><input type="number" id="sconf" min="0"
                            max="1" step="0.1" value="0.7"></div>
                    <div class="form-group"><label>Source</label>
                        <select id="ssrc">
                            <option value="manual">Manual</option>
                            <option value="resume">Resume</option>
                            <option value="linkedin">LinkedIn</option>
                            <option value="course">Course</option>
                        </select>
                    </div>
                </div>
                <button onclick="addSkill()">Add Skill</button>
                <div id="r2"></div>
            </div>
            <div class="section">
                <h2>View Skills</h2>
                <div class="form-group"><label>User ID</label><input id="vsid"></div>
                <button onclick="viewSkills()">View Skills</button>
                <div id="r3"></div>
            </div>
        </div>
        <div id="t2" class="tab-content">
            <div class="section">
                <h2>Preview LinkedIn</h2>
                <p style="color:#666;margin-bottom:10px">Mock LinkedIn data preview</p>
                <button onclick="previewLI()">Preview</button>
                <div id="r4"></div>
            </div>
            <div class="section">
                <h2>Import from LinkedIn</h2>
                <div class="form-group"><label>User ID *</label><input id="liid"></div>
                <div class="form-group"><label>Import Type</label>
                    <select id="litype">
                        <option value="all">All</option>
                        <option value="skills">Skills Only</option>
                        <option value="courses">Courses Only</option>
                    </select>
                </div><button onclick="importLI()">Import</button>
                <div id="r5"></div>
            </div>
        </div>
        <div id="t3" class="tab-content">
            <div class="section">
                <h2>Preview GitHub</h2>
                <p style="color:#666;margin-bottom:10px">Import real projects & skills from GitHub (Free API)</p>
                <div class="form-group"><label>GitHub Username *</label><input id="ghuser" placeholder="torvalds"></div>
                <button onclick="previewGH()">Preview</button>
                <div id="r9"></div>
            </div>
            <div class="section">
                <h2>Import from GitHub</h2>
                <div class="form-group"><label>User ID *</label><input id="ghid"></div>
                <div class="form-group"><label>GitHub Username *</label><input id="ghuser2" placeholder="torvalds">
                </div>
                <button onclick="importGH()">Import</button>
                <div id="r10"></div>
            </div>
        </div>
        <div id="t4" class="tab-content">
            <div class="section">
                <h2>Gap Analysis</h2>
                <div class="form-group"><label>User ID *</label><input id="aid"></div>
                <div class="grid">
                    <div class="form-group"><label>Role *</label><input id="arole" placeholder="data scientist"></div>
                    <div class="form-group"><label>Sector</label>
                        <select id="asector">
                            <option>Healthcare</option>
                            <option>Agriculture</option>
                            <option>Urban</option>
                        </select>
                    </div>
                </div>
                <button onclick="runAnalysis()">Analyze</button>
                <div id="r6"></div>
            </div>
            <div class="section">
                <h2>Analysis History</h2>
                <div class="form-group"><label>User ID</label><input id="hid"></div>
                <button onclick="viewHistory()">View History</button>
                <div id="r7"></div>
            </div>
        </div>
        <div id="t5" class="tab-content">
            <div class="section">
                <h2>Resume Analysis</h2>
                <div class="form-group"><label>Resume File</label><input type="file" id="rfile" accept=".pdf,.docx">
                </div>
                <div class="form-group"><label>Target Role *</label><select id="rrole"></select></div>
                <button onclick="analyzeResume()">Analyze</button>
                <div id="r8"></div>
            </div>
        </div>
    </div>
    <script>
        const API = "/api"; let u = null;
        function switchTab(i) {
            document.querySelectorAll(".tab").forEach((t, j) => t.classList.toggle("active", j === i));
            document.querySelectorAll(".tab-content").forEach((t, j) => t.classList.toggle("active", j === i));
            if (i === 5) fetchRoles();
        }
        function setUser(id, name, role, sector) {
            u = { id, name, role, sector }; document.getElementById("userInfo").classList.add("show");
            document.getElementById("uId").textContent = id; document.getElementById("uName").textContent = name;
            document.getElementById("uRole").textContent = role; document.getElementById("uSector").textContent = sector;
            ["vid", "sid", "vsid", "liid", "ghid", "aid", "hid"].forEach(x => document.getElementById(x).value = id);
        }
        function showR(id, data, ok = 1) {
            document.getElementById(id).innerHTML = `<div class="result ${ok ? "success" : "error"}">
<h3>${ok ? " Success" : " Error"}</h3><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
        }
        async function createProfile() {
            const d = {
                name: document.getElementById("name").value,
                email: document.getElementById("email").value, target_sector: document.getElementById("sector").value,
                target_role: document.getElementById("role").value
            }; try {
                const r = await fetch(`${API}/profile`,
                    { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(d) });
                const j = await r.json(); showR("r0", j, r.ok); if (r.ok) setUser(j.user_id, d.name, d.target_role, d.target_sector);
            }
            catch (e) { showR("r0", { error: e.message }, 0); }
        }
        async function viewProfile() {
            const id = document.getElementById("vid").value || u?.id;
            if (!id) return alert("Enter User ID"); try {
                const r = await fetch(`${API}/profile/${id}`);
                const j = await r.json(); if (r.ok) {
                    const h = `<div class="result success"><h3> Profile</h3>
<p><strong>Name:</strong> ${j.user.name}</p><p><strong>Email:</strong> ${j.user.email}</p>
<p><strong>Target:</strong> ${j.user.target_role} (${j.user.target_sector})</p>
<h4 style="margin-top:10px">Skills (${j.skills.length})</h4>
${j.skills.slice(0, 15).map(s => {
                        const c = s.confidence >= 0.7 ? "h" : s.confidence >= 0.4 ? "m" : "l";
                        return `<span class="badge">${s.skill_name}<span class="conf ${c}">${(s.confidence * 100).toFixed(0)}%</span></span>`;
                    }).join("")}
</div>`; document.getElementById("r1").innerHTML = h;
                } else showR("r1", j, 0);
            } catch (e) { showR("r1", { error: e.message }, 0); }
        }
        async function addSkill() {
            const id = document.getElementById("sid").value || u?.id;
            if (!id) return alert("Enter User ID"); const d = {
                skill_name: document.getElementById("sname").value,
                sector_context: document.getElementById("sctx").value, confidence: parseFloat(document.getElementById("sconf").value),
                source: document.getElementById("ssrc").value, evidence: []
            }; try {
                const r = await fetch(`${API}/profile/${id}/skills`,
                    { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(d) });
                const j = await r.json(); showR("r2", j, r.ok);
            } catch (e) { showR("r2", { error: e.message }, 0); }
        }
        async function viewSkills() {
            const id = document.getElementById("vsid").value || u?.id;
            if (!id) return alert("Enter User ID"); try {
                const r = await fetch(`${API}/profile/${id}/skills`);
                const j = await r.json(); if (r.ok) {
                    const h = `<div class="result success"><h3> Skills (${j.total})</h3>
${j.skills.map(s => {
                        const c = s.confidence >= 0.7 ? "h" : s.confidence >= 0.4 ? "m" : "l";
                        return `<span class="badge">${s.skill_name}<span class="conf ${c}">${(s.confidence * 100).toFixed(0)}%</span></span>`;
                    }).join("")}
</div>`; document.getElementById("r3").innerHTML = h;
                } else showR("r3", j, 0);
            } catch (e) { showR("r3", { error: e.message }, 0); }
        }
        async function previewLI() {
            try {
                const r = await fetch(`${API}/import/linkedin/preview`,
                    { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({}) });
                const j = await r.json(); showR("r4", j, r.ok);
            } catch (e) { showR("r4", { error: e.message }, 0); }
        }
        async function importLI() {
            const id = document.getElementById("liid").value || u?.id;
            if (!id) return alert("Enter User ID"); const d = { user_id: id, import_type: document.getElementById("litype").value, access_token: "demo_token" };
            try {
                const r = await fetch(`${API}/import/linkedin`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(d)
                }); const j = await r.json(); showR("r5", j, r.ok);
            } catch (e) { showR("r5", { error: e.message }, 0); }
        }
        async function previewGH() {
            const user = document.getElementById("ghuser").value;
            if (!user) return alert("Enter GitHub username"); try {
                const r = await fetch(`${API}/import/github/preview`,
                    { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ github_username: user }) });
                const j = await r.json(); if (r.ok) {
                    const h = `<div class="result success"><h3> GitHub Preview</h3>
<p><strong>Projects:</strong> ${j.counts.projects} | <strong>Skills:</strong> ${j.counts.skills}</p>
<h4 style="margin-top:10px">Skills</h4>${j.preview.skills.map(s => {
                        const c = s.confidence >= 0.7 ? "h" : s.confidence >= 0.4 ? "m" : "l";
                        return `<span class="badge">${s.name}<span class="conf ${c}">${(s.confidence * 100).toFixed(0)}%</span></span>`;
                    }).join("")}
<h4 style="margin-top:10px">Top Projects</h4>${j.preview.projects.slice(0, 5).map(p =>
                        `<div style="background:#f8f9fa;padding:8px;margin:5px 0;border-radius:5px"><strong>${p.name}</strong> (${p.language}) ⭐ ${p.stars}<br>
<small style="color:#666">${p.description}</small></div>`).join("")}</div>`; document.getElementById("r9").innerHTML = h;
                }
                else showR("r9", j, 0);
            } catch (e) { showR("r9", { error: e.message }, 0); }
        }
        async function importGH() {
            const id = document.getElementById("ghid").value || u?.id;
            const user = document.getElementById("ghuser2").value; if (!id || !user) return alert("Enter User ID and GitHub username");
            const d = { user_id: id, github_username: user }; try {
                const r = await fetch(`${API}/import/github`,
                    { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(d) });
                const j = await r.json(); showR("r10", j, r.ok);
            } catch (e) { showR("r10", { error: e.message }, 0); }
        }
        async function runAnalysis() {
            const id = document.getElementById("aid").value || u?.id;
            if (!id) return alert("Enter User ID"); const d = {
                target_role: document.getElementById("arole").value,
                target_sector: document.getElementById("asector").value
            }; try {
                const r = await fetch(`${API}/gap-analysis/${id}`,
                    { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(d) });
                const j = await r.json(); if (r.ok) {
                    const h = `<div class="result success"><h3> Gap Analysis</h3>
<div class="score">${j.readiness_score}%</div><p style="text-align:center;color:#666;margin-bottom:15px">
Readiness for ${j.target_role}</p><h4> Missing Required (${j.analysis.missing_required_skills.length})</h4>
${j.analysis.missing_required_skills.map(s => `<div class="rec high">${s.skill} - ${s.reason}</div>`).join("") || "<p>None!</p>"}
<h4 style="margin-top:15px"> Recommendations (${j.recommendations.length})</h4>
${j.recommendations.map(r => `<div class="rec ${r.priority}"><strong>${r.action}</strong><br><small>${r.reason}</small></div>`).join("")}
</div>`; document.getElementById("r6").innerHTML = h;
                } else showR("r6", j, 0);
            } catch (e) { showR("r6", { error: e.message }, 0); }
        }
        async function viewHistory() {
            const id = document.getElementById("hid").value || u?.id;
            if (!id) return alert("Enter User ID"); try {
                const r = await fetch(`${API}/gap-analysis/${id}/history`);
                const j = await r.json(); showR("r7", j, r.ok);
            } catch (e) { showR("r7", { error: e.message }, 0); }
        }
        async function analyzeResume() {
            const f = document.getElementById("rfile").files[0];
            const role = document.getElementById("rrole").value; if (!f || !role) return alert("Select file and enter role");
            const fd = new FormData(); fd.append("file", f); fd.append("target_role", role);
            try {
                const r = await fetch(`${API}/resume/analyze`, { method: "POST", body: fd });
                const j = await r.json();
                if (r.ok) {
                    let h = `<div class="result success"><h3>Analysis Result</h3>`;
                    h += `<h4>Extracted Skills (${j.skills.length})</h4><div style="margin-bottom:15px">`;
                    h += j.skills.map(s => `<span class="badge">${s.name} <span class="conf">${(s.confidence * 100).toFixed(0)}%</span></span>`).join("");
                    h += `</div>`;

                    if (j.roadmap && j.roadmap.length > 0) {
                        h += `<h4>Learning Roadmap</h4><div class="roadmap">`;
                        j.roadmap.forEach(phase => {
                            h += `<div style="background:#f0f4ff;padding:10px;margin-bottom:10px;border-radius:8px">`;
                            h += `<h5 style="color:#2c5282;margin-bottom:5px">${phase.phase}</h5>`;
                            phase.skills.forEach(skill => {
                                h += `<div style="margin-left:10px;margin-bottom:8px"><strong>${skill.name}</strong>`;
                                if (skill.courses && skill.courses.length > 0) {
                                    h += `<ul style="margin-left:20px;margin-top:4px;font-size:13px;color:#555">`;
                                    skill.courses.forEach(c => {
                                        h += `<li><a href="${c.url}" target="_blank" style="color:#667eea;text-decoration:none">${c.title}</a> (${c.platform})</li>`;
                                    });
                                    h += `</ul>`;
                                } else {
                                    h += `<div style="margin-left:20px;font-size:12px;color:#888">No specific courses found</div>`;
                                }
                                h += `</div>`;
                            });
                            h += `</div>`;
                        });
                        h += `</div>`;
                    }
                    h += `</div>`;
                    document.getElementById("r8").innerHTML = h;
                } else {
                    showR("r8", j, 0);
                }
            } catch (e) { showR("r8", { error: e.message }, 0); }
        }

        async function fetchRoles() {
            try {
                const r = await fetch(`${API}/roles`);
                const j = await r.json();
                if (r.ok && j.roles) {
                    const s = document.getElementById("rrole");
                    if (s.options.length === 0) { // Only populate if empty
                        s.innerHTML = j.roles.map(role => `<option value="${role}">${role}</option>`).join("");
                    }
                }
            } catch (e) { console.error("Failed to fetch roles", e); }
        }
        console.log("SkillGenome Ready!");
    </script>
</body>

</html>